version: '3.8'

services:
  next_app_prod:
    container_name: next_app_prod

    # db container will start before the next_app container.
    depends_on:
      - db_prod

    build:
      context: .
      dockerfile: Dockerfile.prod

    restart: always

    # This configuration is mapping the port 3000 of the Docker host (the machine running the Docker daemon, left) to the port 3000 of the Docker container (right).
    ports:
      # The 0.0.0.0 before the first colon is specifying the network interface on the Docker host where the port is exposed. 0.0.0.0 means all IPv4 addresses on the local machine. In other words, the application listening on port 10000 inside the Docker container, can be accessed via port 10000 on any network interface of the Docker host.
      - 0.0.0.0:10000:10000

    env_file:
      - .env.production

    networks:
      - next_app_prod_network

  db_prod:
    container_name: db_prod
    image: postgres:16

    restart: unless-stopped

    volumes:
      - postgres-data:/var/lib/postgresql/data

    env_file:
      - .env.production

    networks:
      - next_app_prod_network

volumes:
  postgres-data:

networks:
  next_app_prod_network:
    driver: bridge
